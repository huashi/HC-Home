<!Doctype html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>小成快报</title>
  <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
  <meta name="Keywords" content="" />
  <meta name="Description" content="" />
  <!-- Mobile Devices Support @begin -->
  <meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
  <meta content="no-cache" http-equiv="pragma">
  <meta content="0" http-equiv="expires">
  <meta content="telephone=no, address=no" name="format-detection">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <style>
      body, div, p, ul, ol, li, textarea, form, input, h1, h2, h3, h4, h5, dl, dt, dd, img, section, article, aside, header, footer, nav, figure, hgroup{margin:0;padding:0;}
      body{font-family:"\5FAE\8F6F\96C5\9ED1", Helvetica,serif;min-width:320px;-webkit-text-size-adjust:none;font-size:14px;color:#5b5b5b;overflow:hidden;-webkit-backface-visibility:hidden;}
      input, button, select, textarea{font-size:15px;font-family: Helvetica,serif;color:#383838;}
      ul, ol, li{list-style:none;}
      a{text-decoration:none;color:#5b5b5b;}
      img{border:0; max-width:100%;display:block;}
      section, article, aside, header, footer, nav, figure, hgroup{display:block;}
      i, cite, em, var, address{font-style:normal;}
      table{border-collapse:collapse;border-spacing:0;}

      body{background: url(http://mat1.gtimg.com/cd/2015/xckb/beijing.jpg) no-repeat top center; background-size: 100% auto;}
      /*06*/
      #wrap{max-width:640px;margin:0 auto;padding-bottom:30px;}

      .logo{width:90px;margin:12px auto 0;overflow:hidden; height: 80px; }
      .timeBox{margin:0 12px;position:relative;margin-bottom:10px;overflow:hidden;}
      .timeBox h1{line-height:30px;color:#515151;font-size:14px;font-family:Arial;font-weight:normal;}
      .timeBox .star{width:43px;height:10px; margin-bottom:5px;}
      .timeBox .star img{width:10px;margin:0 auto;}

      .timeline{width:43px; height:86%; position:absolute;left:0;top:45px;z-index:-5}
      .line{width:5px;height:100%;background:#fff;margin:0 auto;border: 1px solid #eee;border-radius:15px;-webkit-border-radius:15px; box-sizing:border-box; }

      .item{margin-bottom:10px;}
      .item .txt{width:67.5%;padding:10px;border-radius:5px;-webkit-border-radius:5px;position:relative;display:inline-block;}
      .item h2{color:#505050;font-size:14px;font-family:"Microsoft yahei";font-weight:normal; margin-bottom:5px;}
      .item span.sj{width:0; height:0;border-width:8px;position:absolute;}
      .item .pic{width:43px;display:inline-block;vertical-align:top; margin-top:10px;}

      .item1{margin-left:52px;}
      .item1 .txt{border:1px solid #b9b9b9;background:#e7e7e7;margin-right:10px;}
      .item1 span.sj{top:8px;border-style:dashed dashed dashed solid;overflow:hidden;}
      .item1 span.sj1{right:-16px; border-color:transparent transparent transparent #b9b9b9;}
      .item1 span.sj2{right:-15px; border-color:transparent transparent transparent #e7e7e7;}
      .item1 li{width:31.333333%; height:30%; line-height:30%; display:inline-block; display:table-cell; vertical-align:middle; float:left;background:#b4cddd;margin:5px 2px 0px 2px; text-align:center; }
      .item1 li a{ width:100%; height:100%; line-height:100%; display:table-cell; vertical-align:middle;text-align:center; overflow:hidden; }
      .item1 li img{ vertical-align:middle; }

      .item2 .txt,.item3 .txt,.item4 .txt,.item5 .txt{border:1px solid #c7c7c1;background:#ffffff;box-shadow:0 1px 3px #cbcbbd;}
      .item2 span.sj{top:15px;border-style:dashed solid dashed dashed;overflow:hidden;}
      .item2 span.sj1,.item3 span.sj1,.item4 span.sj1,.item5 span.sj1{left:-16px; border-color:transparent #c7c7c1 transparent transparent;}
      .item2 span.sj2,.item3 span.sj2,.item4 span.sj2,.item5 span.sj2{left:-15px; border-color:transparent #ffffff transparent transparent;}
      .item2 .pic,.item3 .pic,.item4 .pic,.item5 .pic{margin-right:7px;}
      .item2 h2,.item1 h2,.item3 h2,.item5 h2{ margin-bottom:0px;}

      .item3 .txt{border:1px solid #c7c7c1;background:#ffffff;}
      .item3 .tp{background:#b4cddd;overflow:hidden;text-align:ceter;}
      .item3 h2{line-height:30px;text-align:center; margin-bottom:0px; }
      .item3 p{color:#8e8e8e;font-size:12px;font-family:"Microsoft yahei";border-top:1px solid #b5b5b5;padding-top:10px;}
      .item3 .link{text-align:right;margin-top:5px;}
      .item3 .link a{text-align:right;color:#386ea5;font-size:12px;font-family:"Microsoft yahei";}
      .item3 span.sj{top:43px;border-style:dashed solid dashed dashed;overflow:hidden;}
      .item3 .pic{margin-top:39px;}

      .item4 .tp{width:52px;height:52px;background:#b4cddd;float:left;margin-right:8px;overflow:hidden}
      .item4 p{color:#8e8e8e;font-size:12px;font-family:"Microsoft yahei";}
      .item4 .link{position:absolute;bottom:10px;right:10px;}
      .item4 .link a{line-height:15px;text-align:right;color:#386ea5;font-size:12px;font-family:"Microsoft yahei";}
      .item4 span.sj{top:23px;border-style:dashed solid dashed dashed;overflow:hidden;}
      .item4 .pic{margin-top:19px;}


      .item5 .txt{border:1px solid #c7c7c1;background:#ffffff;}
      .item5 .tp{background:#b4cddd;overflow:hidden;text-align:ceter;}
      .item5 p{color:#8e8e8e;font-size:12px;font-family:"Microsoft yahei";border-top:1px solid #b5b5b5;padding-top:10px;}
      .item5 .link{text-align:right;margin-top:5px;}
      .item5 .link a{text-align:right;color:#386ea5;font-size:12px;font-family:"Microsoft yahei";}
      .item5 span.sj{top:43px;border-style:dashed solid dashed dashed;overflow:hidden;}
      .item5 .pic{margin-top:39px;}

      .item5 li{width:31.333333%; height:30%; line-height:30%; display:inline-block; display:table-cell; vertical-align:middle; float:left;background:#b4cddd;margin:5px 2px 0px 2px; text-align:center; }
      .item5 li a{ width:100%; height:100%; line-height:100%; display:table-cell; vertical-align:middle;text-align:center; overflow:hidden; }
      .item5 li img{ vertical-align:middle; }

      .more{ width:60%; margin:10px auto; height:32px; line-height:32px; border-radius:4px; background:#fff; border:1px solid #c7c7c1; text-align:center; box-shadow:0 1px 3px #cbcbbd; }
  </style>

  <link rel="stylesheet" href="http://mat1.gtimg.com/cd/2015/xckb/swipebox.css">
  <!--05-->
</head>
<body bgcolor="#d9dacb">
<div id="wrap">
  <div class="logo"></div>
  <div id="maindata"></div>
  <div class="more">向上滑动查看更多</div>
</div>


<%= javascript_include_tag 'jquery-2.1.1.min','jquery.swipebox.min' %>

<!--04-->
<script>
    var page = 1, total = 0;
    function  getList(data) {
        if(!data) {
            $('.more').html('数据已经全部加载完').show();
            return false;
        }
        for(var date in data) {

            var append_str  = '';
            append_str += '<div class="timeBox"><h1>'+date+'</h1><div class="star"><img src="http://mat1.gtimg.com/cd/2015/xckb/time_star.png"></div><div class="timeline"><div class="line"></div></div><div class="txtBox">';

            var tempData = data[date];
            for(var j=0; j<tempData.length; j++) {
                switch(parseInt(tempData[j].type)){
                    case 1:
                        append_str += '<div class="item item1"><div class="txt"><h2>'+tempData[j].content+'</h2><span class="sj sj1"></span><span class="sj sj2"></span></div><div class="pic"><img src="'+tempData[j].author+'"></div></div>';
                        break;
                    case 2:
                        var piclist = tempData[j].piclist.split(',');
                        var piclist_str = '';
                        for(var a = 0; a<piclist.length;a++){
                            piclist_str += '<li><a href="'+piclist[a]+'" class="swipebox" title=""><img src="'+piclist[a]+'" alt="image"></a></li>';
                        }
                        append_str += '<div class="item item1"><div class="txt"><h2>'+tempData[j].content+'</h2><ul>'+piclist_str+'</ul><span class="sj sj1"></span><span class="sj sj2"></span></div><div class="pic"><img src="'+tempData[j].author+'"></div></div>';
                        break;
                    case 3:
                        append_str += '<div class="item item2"><div class="pic"><img src="'+tempData[j].author+'"></div><div class="txt"><h2>'+tempData[j].content+'</h2><span class="sj sj1"></span><span class="sj sj2"></span></div></div>';
                        break;
                    case 4:
                        append_str += '<div class="item item3"><div class="pic"><img src="'+tempData[j].author+'"></div><div class="txt"><div class="tp"><img src="'+tempData[j].pic+'"></div><h2>'+tempData[j].title+'</h2><p>'+tempData[j].content+'</p><span class="sj sj1"></span><span class="sj sj2"></span><div class="link"><a href="'+tempData[j].link+'">全文</a></div></div></div>';
                        break;
                    case 5:
                        append_str += '<div class="item item4"><div class="pic"><img src="'+tempData[j].author+'"></div><div class="txt"><h2>'+tempData[j].title+'</h2><div class="tp"><img src="'+tempData[j].pic+'"></div><p>'+tempData[j].content+'</p><div class="link"><a href="'+tempData[j].link+'">全文</a></div><span class="sj sj1"></span><span class="sj sj2"></span></div></div>';
                        break;
                    case 6:
                        var piclist = tempData[j].piclist.split(',');
                        var piclist_str = '';
                        for(var a = 0; a<piclist.length;a++){
                            piclist_str += '<li><a href="'+piclist[a]+'" class="swipebox" title=""><img src="'+piclist[a]+'" alt="image"></a></li>';
                        }
                        append_str += '<div class="item item5"><div class="pic"><img src="'+tempData[j].author+'"></div><div class="txt"><h2>'+tempData[j].content+'</h2><ul>'+piclist_str+'</ul><span class="sj sj1"></span><span class="sj sj2"></span></div></div>';
                        break;
                    default:
                        break;
                }
            }
            append_str +='</div></div>';
            $('#maindata').append(append_str);
        }
    }
    function loadPage() {
        if(total > 0 && page > total) {
            $('.more').html('数据已经全部加载完').show();
            return false;
        }

        $.ajax({
            url: 'ds',
//            03
            data: {page: page},
            dataType: 'json',
            success:function(R) {
                if(total == 0) {
                    total = R.pages.total;
                }
                if(R.list && R.pages.page <= R.pages.total) {
                    getList(R.list);
                    page++;
                }
            },
            error:function(e){
            console.log(e);
        }
        });
    }

    $(document).ready(function() {
        loadPage();
        $('.swipebox').swipebox();
    });

    $(window).scroll(function () {
        var scrollTop = $(this).scrollTop();
        var scrollHeight = $(document).height();
        var windowHeight = $(this).height();
        if (scrollTop + windowHeight == scrollHeight) {
            loadPage();
        }
    });

    var imgUrl = 'http://mat1.gtimg.com/cd/weixin/cdlife.jpg';
    var lineLink = 'http://wxmp.city.qq.com/26/page-48';
    var descContent = "花更少的钱过更有品的生活！成都生活，关注生活，关注你~";
    var shareTitle = '成都正发生的新鲜事，快来qio一哈！';
    var appid = '';

    //    02

    function shareFriend() {
        WeixinJSBridge.invoke('sendAppMessage',{
            "appid": appid,
            "img_url": imgUrl,
            "img_width": "640",
            "img_height": "640",
            "link": lineLink,
            "desc": descContent,
            "title": shareTitle
        }, function(res) {
            _report('send_msg', res.err_msg);
        });
    }
    function shareTimeline() {
        WeixinJSBridge.invoke('shareTimeline',{
            "img_url": imgUrl,
            "img_width": "640",
            "img_height": "640",
            "link": lineLink,
            "desc": descContent,
            "title": shareTitle
        }, function(res) {
            _report('timeline', res.err_msg);
        });
    }
    function shareWeibo() {
        WeixinJSBridge.invoke('shareWeibo',{
            "content": descContent,
            "url": lineLink,
        }, function(res) {
            _report('weibo', res.err_msg);
        });
    }

    function onBridgeReady(){
        WeixinJSBridge.call('showOptionMenu');
        WeixinJSBridge.call('hideToolbar');

        // 发送给好友
        WeixinJSBridge.on('menu:share:appmessage', function(argv){
            shareFriend();
        });

        // 分享到朋友圈
        WeixinJSBridge.on('menu:share:timeline', function(argv){
            shareTimeline();
        });

        // 分享到微博
        WeixinJSBridge.on('menu:share:weibo', function(argv){
            shareWeibo();
        });
    }

    if (typeof WeixinJSBridge == "undefined"){
        if( document.addEventListener ){
            document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
        }else if (document.attachEvent){
            document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
            document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
        }

    }else{
        onBridgeReady();
    }
</script>

<script type="text/javascript" src="http://tajs.qq.com/stats?sId=34091436" charset="UTF-8"></script>
<!--01-->
</body>
</html>